var Http=function(){function e(){}return e.prototype.mydata=function(){var e=new Laya.HttpRequest;e.http.timeout=1e4,e.once(Laya.Event.COMPLETE,this,this.completeHandler),e.once(Laya.Event.ERROR,this,this.errorHandler),e.once(Laya.Event.PROGRESS,this,this.processHandler),e.send("http://www.fmtoa.com/gamed/game/boss?id="+gameInstance.id[2],"null","post","json")},e.prototype.processHandler=function(e){},e.prototype.errorHandler=function(e){},e.prototype.completeHandler=function(e){return console.log(e),this.data=e,this.overurl=e.url,e},e.prototype.datas=function(e){window.location.href=this.overurl+"&hp="+e},e}(),mydatas=new Http,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function a(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),View=laya.ui.View,Dialog=laya.ui.Dialog,ui;!function(e){var t=function(t){function o(){return t.call(this)||this}return __extends(o,t),o.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.GameInfoUI.uiView)},o.uiView={type:"View",props:{width:480,height:852},child:[{type:"Button",props:{y:55,x:391,width:60,"var":"pauseBtn",stateNum:"1",skin:"war/btn_pause.png",height:45}},{type:"Label",props:{y:55,x:20,width:80,"var":"hpLabel",text:"HP:5",height:33,fontSize:24,color:"#5fff05",align:"center"}},{type:"Label",props:{y:55,x:102,width:106,"var":"levelLabel",text:"Level:50",height:33,fontSize:24,color:"#fbfbfb",align:"center"}},{type:"Label",props:{y:55,x:213,width:79,"var":"scoreLabel",text:"Score:100",height:33,fontSize:24,color:"#fdc105",align:"center"}},{type:"Label",props:{y:427,x:21,wordWrap:!0,width:445,"var":"infoLabel",text:"战斗结束",height:136,fontSize:24,color:"#fbfbfb",align:"center"}},{type:"ProgressBar",props:{y:26,x:27,"var":"timeBar",value:1,skin:"war/progress_time.png"}}]},o}(View);e.GameInfoUI=t}(ui||(ui={})),function(e){var t=function(t){function o(){return t.call(this)||this}return __extends(o,t),o.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.createView(e.GameStartUI.uiView)},o.uiView={type:"View",props:{y:0,x:0,width:480,height:852},child:[{type:"Image",props:{y:0,x:0,width:480,"var":"bot",skin:"war/smbg.png",height:852}},{type:"Button",props:{y:533,x:124,width:225,"var":"start",stateNum:"2",skin:"war/btn_start.png",height:102}},{type:"Label",props:{y:819,x:127,width:301,text:"技术支持:  河南野人智能科技",height:28,fontSize:18,font:"Helvetica",color:"#f9f6f6"}}]},o}(View);e.GameStartUI=t}(ui||(ui={}));var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function a(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),GameInfo=function(e){function t(){var t=e.call(this)||this;return t.timeBar.value=1,t.pauseBtn.on(Laya.Event.CLICK,t,t.onPauseBtnClick),t.reset(),t}return __extends(t,e),t.prototype.reset=function(){this.timeBar.value=gameInstance.HPS,this.infoLabel.text="",this.hp(5),this.level(0),this.score(0)},t.prototype.onPauseBtnClick=function(e){e.stopPropagation(),this.infoLabel.text="游戏已暂停，点击任意地方恢复游戏",gameInstance.pause(),Laya.stage.once(Laya.Event.CLICK,this,this.onStageClick)},t.prototype.onStageClick=function(e){this.infoLabel.text="",gameInstance.resume()},t.prototype.hp=function(e){this.hpLabel.text="HP:"+e},t.prototype.level=function(e){this.levelLabel.text="Level:"+e},t.prototype.score=function(e){this.scoreLabel.text="Score:"+e},t.prototype.HP=function(e){this.timeBar.value=e/200},t}(ui.GameInfoUI),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function a(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),Myurl=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(e){this.name=e;var t=new RegExp("(^|&)"+this.name+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);gameInstance.id=o},t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function a(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),Role=function(e){function t(){var t=e.call(this)||this;return t.shootType=0,t.shootInterval=500,t.shootTime=Laya.Browser.now()+2e3,t.shootTimes=Laya.Browser.now()+2e3,t.action="",t.isBullet=!1,t.heroType=0,t}return __extends(t,e),t.prototype.init=function(e,o,a,n,i,r){void 0===r&&(r=0),this.type=e,this.camp=o,this.hp=a,this.speed=n,this.hitRadius=i,this.heroType=r,t.cached||(t.cached=!0,Laya.Animation.createFrames(["war/hero_fly1.png","war/hero_fly2.png"],"hero_fly"),Laya.Animation.createFrames(["war/hero_down1.png","war/hero_down2.png","war/hero_down3.png","war/hero_down4.png"],"hero_down"),Laya.Animation.createFrames(["war/enemy1_fly1.png"],"enemy1_fly"),Laya.Animation.createFrames(["war/enemy1_down1.png","war/enemy1_down2.png","war/enemy1_down3.png","war/enemy1_down4.png"],"enemy1_down"),Laya.Animation.createFrames(["war/enemy2_fly1.png"],"enemy2_fly"),Laya.Animation.createFrames(["war/enemy2_down1.png","war/enemy2_down2.png","war/enemy2_down3.png","war/enemy2_down4.png"],"enemy2_down"),Laya.Animation.createFrames(["war/enemy2_hit.png"],"enemy2_hit"),Laya.Animation.createFrames(["war/enemy3_fly1.png","war/enemy3_fly2.png"],"enemy3_fly"),Laya.Animation.createFrames(["war/enemy3_down1.png","war/enemy3_down2.png","war/enemy3_down3.png","war/enemy3_down4.png","war/enemy3_down5.png","war/enemy3_down6.png"],"enemy3_down"),Laya.Animation.createFrames(["war/enemy3_hit.png"],"enemy3_hit"),Laya.Animation.createFrames(["war/enemy4_fly1.png","war/enemy4_fly2.png"],"enemy4_fly"),Laya.Animation.createFrames(["war/enemy4_down1.png","war/enemy4_down2.png","war/enemy4_down3.png","war/enemy4_down4.png","war/enemy4_down5.png","war/enemy4_down6.png"],"enemy4_down"),Laya.Animation.createFrames(["war/enemy4_hit.png"],"enemy4_hit"),Laya.Animation.createFrames(["war/bullet1.png"],"bullet1_fly"),Laya.Animation.createFrames(["war/ufo1.png"],"ufo1_fly"),Laya.Animation.createFrames(["war/ufo2.png"],"ufo2_fly")),this.body||(this.body=new Laya.Animation,this.addChild(this.body),this.body.on(Laya.Event.COMPLETE,this,this.onPlayComplete)),this.playAction("fly")},t.prototype.onPlayComplete=function(){"down"===this.action?(this.body.stop(),this.visible=!1):"hit"===this.action&&this.playAction("fly")},t.prototype.playAction=function(e){this.action=e,this.body.play(0,!0,this.type+"_"+e);var t=this.body.getBounds();this.body.pos(-t.width/2,-t.height/2)},t.cached=!1,t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function a(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),BackGround=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){var e=Laya.Pool.getItemByClass("myurl",Myurl);e.init("id"),mydatas.mydata(),this.bg1=new Laya.Sprite,this.bg1.loadImage("war/background.png"),this.addChild(this.bg1),this.bg2=new Laya.Sprite,this.bg2.loadImage("war/background.png"),this.bg2.pos(0,-852),this.addChild(this.bg2),Laya.timer.frameLoop(1,this,this.onLoop)},t.prototype.onLoop=function(){this.y+=1,this.bg1.y+this.y>=852&&(this.bg1.y-=1704),this.bg2.y+this.y>=852&&(this.bg2.y-=1704)},t}(Laya.Sprite),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function a(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(a.prototype=o.prototype,new a)}}(),GameStart=function(e){function t(){var t=e.call(this)||this;return t.start.on(Laya.Event.CLICK,t,t.onPauseBtnClick),t}return __extends(t,e),t.prototype.onPauseBtnClick=function(e){this.removeSelf();Laya.Pool.getItemByClass("myurl",Myurl);gameInstance.restart()},t}(ui.GameStartUI),Game=function(){function e(){this.bulletPos=[[0],[-15,15],[-30,0,30],[-45,-15,15,45],[-60,-30,0,30,60],[-60,-40,-20,20,40,60],[-60,-40,-20,0,20,40,60],[-60,-45,-30,-15,15,30,45,60],[-60,-45,-30,-15,0,15,30,45,60],[-75,-60,-45,-30,-15,15,30,45,60,75],[-75,-60,-45,-30,-15,0,15,30,45,60,75]],this.level=0,this.score=0,this.levelUpScore=10,this.bulletLevel=0,this.hps=[1,2,2],this.speeds=[3,2,1],this.radius=[15,30,50,75],this.HPS=1,this.HPs=200,this.gameBoss=0,Laya.init(480,852,Laya.WebGL),Laya.stage.scaleMode="showall",Laya.stage.alignH="center",Laya.stage.screenMode="vertical";var e=[{url:"res/atlas/war.json",type:Laya.Loader.ATLAS},{url:"war/smbg.png",type:Laya.Loader.IMAGE}];Laya.loader.load(e,Laya.Handler.create(this,this.onLoaded),null)}return e.prototype.onLoaded=function(){var e=new BackGround;Laya.stage.addChild(e),this.roleBox=new Laya.Sprite,Laya.stage.addChild(this.roleBox),this.gameInfo=new GameInfo,Laya.stage.addChild(this.gameInfo),this.hero=new Role,this.roleBox.addChild(this.hero),this.gameStart=new GameStart,Laya.stage.addChild(this.gameStart)},e.prototype.onLoop=function(){for(var e=this.roleBox.numChildren-1;e>-1;e--){var t=this.roleBox.getChildAt(e);if(t&&t.speed&&(t.y+=t.speed,(t.y>1e3||!t.visible||t.isBullet&&t.y<-20)&&(t.removeSelf(),t.isBullet=!1,t.visible=!0,Laya.Pool.recover("role",t))),t.shootType>0){var o=Laya.Browser.now();if(o>t.shootTime){t.shootTime=o+t.shootInterval;for(var a=this.bulletPos[t.shootType-1],n=0;n<a.length;n++){var i=Laya.Pool.getItemByClass("role",Role);i.init("bullet1",t.camp,1,-4-t.shootType-Math.floor(this.level/15),1,1),i.pos(t.x+a[n],t.y-t.hitRadius-10),this.roleBox.addChild(i)}Laya.SoundManager.playSound("res/sound/bullet.mp3")}}}for(var e=this.roleBox.numChildren-1;e>-1;e--){var r=this.roleBox.getChildAt(e);if(!(r.hp<1))for(var s=e-1;s>-1;s--)if(r.visible){var h=this.roleBox.getChildAt(s);if(h.hp>0&&r.camp!=h.camp){var p=r.hitRadius+h.hitRadius;Math.abs(r.x-h.x)<p&&Math.abs(r.y-h.y)<p&&(this.lostHp(r,1),this.lostHp(h,1),this.score++,this.gameInfo.score(this.score),this.score>this.levelUpScore&&(this.level++,this.gameInfo.level(this.level),this.levelUpScore+=5*this.level))}}}this.hero.hp<1&&(Laya.SoundManager.playSound("res/sound/game_over.mp3"),Laya.timer.clear(this,this.onLoop),this.gameInfo.infoLabel.text="GameOver,分数："+this.score+"\n点击这里重新开始游戏。",this.gameInfo.infoLabel.once(Laya.Event.CLICK,this,this.restart),mydatas.datas(this.HPs));var l=this.level<30?2*this.level:60,y=Math.floor(this.level/7),c=Math.floor(this.level/7),u=Math.floor(this.level/6);Laya.timer.currFrame%(80-l)===0&&this.createEnemy(0,3+u,4+y,1),Laya.timer.currFrame%(150-4*l)===0&&this.createEnemy(1,1+u,4+y,2+2*c),Laya.timer.currFrame%(900-4*l)===0&&(this.createEnemy(2,1,1+y,6+6*c),Laya.SoundManager.playSound("res/sound/enemy3_out.mp3"));var m=Laya.Browser.now();t.shootTimes<m&&(t.shootTimes=m+3e4,this.createEnemy(2,1,0,100),Laya.SoundManager.playSound("res/sound/enemy3_out.mp3"))},e.prototype.lostHp=function(e,t){if(e.hp-=t,"enemy4"==e.type&&(this.gameInfo.HP(e.hp),this.HPs=e.hp),2===e.heroType)this.bulletLevel++,this.hero.shootType=Math.min(Math.floor(this.bulletLevel)+1,10),this.hero.shootInterval=500-20*(this.bulletLevel>20?20:this.bulletLevel),e.visible=!1,Laya.SoundManager.playSound("res/sound/achievement.mp3");else if(3===e.heroType)this.hero.hp++,this.gameInfo.hp(this.hero.hp),this.hero.hp>10&&(this.hero.hp=10),e.visible=!1,Laya.SoundManager.playSound("res/sound/achievement.mp3");else if(e.hp>0)e.playAction("hit");else if(e.heroType>0)e.visible=!1;else if("enemy4"===e.type&&(Laya.SoundManager.playSound("res/sound/game_over.mp3"),Laya.timer.clear(this,this.onLoop),mydatas.datas(this.HPs),this.gameInfo.infoLabel.text="win,分数："+this.score+"\n恭喜你。"),"hero"!=e.type&&Laya.SoundManager.playSound("res/sound/"+e.type+"_down.mp3"),e.playAction("down"),"enemy3"==e.type){var o=Math.random()<.7?2:3,a=Laya.Pool.getItemByClass("role",Role);a.init("ufo"+(o-1),e.camp,1,1,15,o),a.pos(e.x,e.y),this.roleBox.addChild(a)}e==this.hero&&this.gameInfo.hp(e.hp)},e.prototype.restart=function(){this.HPS=mydatas.data.hp/200,this.HPs=mydatas.data.hp,this.gameBoss=0,this.score=0,this.level=0,this.levelUpScore=10,this.bulletLevel=0,this.gameInfo.reset(),this.hero.init("hero",0,5,0,30),this.hero.shootType=1,this.hero.pos(200,500),this.hero.shootInterval=500,this.hero.visible=!0;for(var e=this.roleBox.numChildren-1;e>-1;e--){var t=this.roleBox.getChildAt(e);t!=this.hero&&(t.removeSelf(),t.visible=!0,Laya.Pool.recover("role",t))}this.resume()},e.prototype.pause=function(){Laya.timer.clear(this,this.onLoop),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)},e.prototype.resume=function(){Laya.timer.frameLoop(1,this,this.onLoop),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.onMouseMove)},e.prototype.onMouseMove=function(){this.hero.pos(Laya.stage.mouseX,Laya.stage.mouseY)},e.prototype.createEnemy=function(e,t,o,a){if(0==o&&0===this.gameBoss){this.gameBoss=1;var n=Laya.Pool.getItemByClass("role",Role);n.init("enemy"+(e+2),1,this.HPs,0,this.radius[e+1]),n.pos(250,100),this.roleBox.addChild(n)}else for(var i=0;t>i;i++){var n=Laya.Pool.getItemByClass("role",Role);n.init("enemy"+(e+1),1,a,o,this.radius[e]),n.pos(400*Math.random()+40,200*-Math.random()-100),this.roleBox.addChild(n)}},e}(),gameInstance=new Game;